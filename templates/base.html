{% set active_theme = page.theme if page.theme is defined else (site.theme.default if site.theme is defined and
site.theme.default is defined else (site.theme if site.theme is defined else "dracula")) %}
<!DOCTYPE html>
<html lang="en" data-theme="{{ active_theme }}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} | {{ site.site_name }}</title>
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <link rel="icon" type="image/svg+xml" href="/templates/icons/toppage.svg">

</head>

<body class="pt-24 min-h-screen flex flex-col">

  <div class="navbar bg-base-100 fixed top-0 left-0 z-50">
    <div class="flex-1">
      <a href="/" class="btn btn-ghost text-xl">{{ site.site_name }}</a>
    </div>
    <div class="flex-none">
      <ul class="menu menu-horizontal px-1">
        {% for item in site.navigation %}
        <li><a href="{{ item.url }}">{{ item.name }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <main class="flex-grow container mx-auto p-8">
    {% block content %}{% endblock %}
  </main>

  <!-- ðŸŽµ LAST.FM MUSIC BAR -->
<div id="music-bar"
  class="bg-base-300 w-full border-t">

  <div class="container mx-auto px-8 py-6 flex items-center justify-between">

    <div class="flex items-center gap-4">
      <img id="cover" src="/photos/placeholder.jpg"
           class="w-12 h-12 rounded-md" />

      <div>
        <p class="text-sm opacity-60">ðŸŽµ Last played:</p>
        <p id="song" class="font-bold text-lg">Loading...</p>
        <p id="artist" class="text-sm opacity-70"></p>
      </div>
    </div>

    <a href="https://open.spotify.com/user/e2bxcqv1bylokq9d4hf0flmmm?si=Uh8SHFqjSRyjlTquDwkWCg"
       class="btn btn-ghost">
       Check out my spotify
    </a>

  </div>
</div>
<!-- END MUSIC BAR -->


  <footer class="mt-auto w-full text-center py-6">
    Error 404: Sleep not found.
  </footer>

  <!-- LAST.FM SCRIPT -->
  <script>
  const API_KEY = "{{ site.lastfm_api_key }}";
  const USER = "{{ site.lastfm_user }}";

  async function loadLastPlayed() {
    try {
      const url =
        `https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${USER}&api_key=${API_KEY}&limit=1&format=json`;

      const res = await fetch(url);
      const data = await res.json();
      const track = data.recenttracks.track[0];

      document.getElementById("song").innerText = track.name;
      document.getElementById("artist").innerText =
        track.artist["#text"] + " â€¢ " + track.album["#text"];

      const images = track.image;
      document.getElementById("cover").src =
        images[images.length - 1]["#text"] || "/photos/placeholder.jpg";

    } catch (e) {
      document.getElementById("song").innerText = "No recent track found";
    }
  }

  loadLastPlayed();
  setInterval(loadLastPlayed, 30000);
  </script>

</body>
</html>
